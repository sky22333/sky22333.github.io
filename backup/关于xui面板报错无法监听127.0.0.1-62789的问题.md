## 关于xui面板报错`无法监听127.0.0.1:62789`


#### 很多网友在用服务器搭建xui面板创建节点的时候，会出现报错的问题，报错信息大致为：`无法监听127.0.0.1:62789`
#### 表现如图：
![photo_2024-07-18_15-03-38](https://github.com/user-attachments/assets/8c6952ad-9dd7-4f60-a216-046f8b90b948)


#### 这种情况多发于小IDC厂商，正经大厂基本没有这个问题，经过我的排查，原因在于小IDC商家都是用的智简魔方系统，这个IDC系统有BUG，BUG的现象是配置的系统没有把`127.0.0.1`绑定为本地环回地址，才导致监听失败，因为xui找不到这个IP，自然就监听失败。

#### 排查方法：使用`ip addr show lo`命令查看本地环回地址的IP
![photo_2024-07-18_15-00-50](https://github.com/user-attachments/assets/e036e28b-768b-41bb-ba90-cba455f0bb79)
####  ❗这里可以看到本机地址确实没有`127.0.0.1`

#### 解决方案其实很简单，就是把`127.0.0.1`分配给本地环回地址即可。

#### 命令：`sudo ip addr add 127.0.0.1/8 dev lo`


#### 这样配置后，重启一下xray，就没有这个报错信息了。


---

#### 后来我看到有些网友说把`dokodemo-door`入站改为`0.0.0.0`就行了，其实这个方法是不对的，因为入站部分的`dokodemo-door`是用于内部转发的，将捕获的流量重定向到指定的xray地址和端口，方便更多自定义的出站等等，这里的入站改为`0.0.0.0`的话，不当的流量重定向配置可能导致内部连接循环，增加大量连接数，也会导致很多循环连接的尝试

####  重要的是会有安全问题，任何人都能访问你的api入站，公网环境时时刻刻都有攻击者在扫IP，当别人扫到你的IP后，会有脚本自动化发送各种类型的请求以测试开放端口的响应，也会出现大量tcp连接数，导致爆内存。

#### 当你把`dokodemo-door`入站改为`0.0.0.0`的话，用一段时间后可能会出现下面的结果：

![photo_2024-07-18_15-09-07](https://github.com/user-attachments/assets/d3e97c67-2af6-4a39-aaf9-64f5dce8f95c)

---
#### ❗这里左边的资源监控可以看到xui占满了内存，同时xui有大量的tcp连接数，并且我查了xui登录日志，没有其他的IP登录，只有大量连接数。
![photo_2024-07-18_15-09-11](https://github.com/user-attachments/assets/9727e4f8-c653-47eb-a4ef-c8049b193dbf)

---

####   ❗这里码掉的IP是本机的公网IP，由此发现大量的连接数来自公网入站，将公网流量重定向到本地62789端口，但是为什么是自己的公网IP呢，是因为攻击者扫描你时是通过api到达`dokodemo-door`，不是直接入站的，这是xui面板的机制，所以这里tcp请求日志是自己的公网IP

![photo_2024-07-18_15-09-16](https://github.com/user-attachments/assets/c7c44eb1-c395-42b9-9f82-445a8244a702)


---
### 然后我将`dokodemo-door`入站改为`127.0.0.1`后，立马就恢复正常了。
TG春雨，如果分析的不对，欢迎纠正。
